<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIN Lookup Tool</title>

    <style>
        :root {
            --bsu-blue: #0033A0;
            --bsu-orange: #D64309;
            --bsu-light-gray: #f4f4f4;
            --bsu-dark-gray: #333;
            --bsu-white: #fff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bsu-light-gray); color: var(--bsu-dark-gray); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: var(--bsu-white); border-radius: 5px; border: 1px solid var(--bsu-blue); overflow: hidden; }
        .header { background-color: var(--bsu-blue); color: var(--bsu-white); padding: 30px; text-align: center; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .content { padding: 30px; }
        .search-section { margin-bottom: 30px; }
        .search-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ccc; }
        .tab { padding: 10px 20px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: 1em; color: #666; transition: all 0.3s; border-radius: 4px 4px 0 0; }
        .tab.active { color: var(--bsu-blue); border-bottom-color: var(--bsu-blue); font-weight: 600; }
        .tab:hover { background-color: var(--bsu-blue); color: var(--bsu-white); }
        .search-form { display: none; background-color: var(--bsu-white); padding: 1rem; border: 1px solid var(--bsu-blue); border-radius: 5px; }
        .search-form.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--bsu-dark-gray); font-weight: 600; }
        input[type="text"], input[type="number"] { width: 100%; padding: 0.4rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .form-row { display: flex; gap: 15px; align-items: flex-start; }
        .form-row .form-group { flex: 1; }
        .form-row .form-group:last-child { flex: 0 0 150px; }

        button.search-btn { padding: 0.5rem 1rem; background-color: var(--bsu-blue); color: var(--bsu-white); border: none; border-radius: 4px; font-size: 1em; cursor: pointer; font-weight: bold; width: 100%; }
        button.search-btn:hover { background-color: var(--bsu-orange); }
        button.search-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .status { margin: 20px 0; padding: 1rem; border-radius: 5px; font-weight: 500; border-left: 4px solid var(--bsu-blue); background-color: var(--bsu-white); }
        .status.success { border-left-color: #28a745; background-color: #d4edda; color: #155724; }
        .status.error { border-left-color: #dc3545; background-color: #f8d7da; color: #721c24; }
        .results-header { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #ccc; }
        .results-header h2 { color: var(--bsu-blue); font-size: 1.3em; }

        /* Table Container - Scrollable */
        .table-container {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }

        /* Table Styling */
        table.dataframe {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            min-width: 600px;
        }
        table.dataframe th {
            background: var(--bsu-blue);
            color: var(--bsu-white);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #ccc;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        table.dataframe th:hover {
            background: var(--bsu-orange);
        }
        table.dataframe th .sort-indicator {
            margin-left: 5px;
            font-size: 0.8em;
        }
        table.dataframe td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
            white-space: nowrap;
        }
        table.dataframe tbody tr:hover {
            background-color: #f5f5f5;
        }
        table.dataframe tbody tr:nth-child(even) {
            background-color: #fafafa;
        }

        .hidden { display: none; }
        .hint { font-size: 0.85em; color: #666; margin-top: 5px; min-height: 20px; }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
        }
        .pagination button {
            padding: 8px 12px;
            background-color: var(--bsu-white);
            color: var(--bsu-blue);
            border: 1px solid var(--bsu-blue);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            min-width: 40px;
        }
        .pagination button:hover:not(:disabled) {
            background-color: var(--bsu-blue);
            color: var(--bsu-white);
        }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination button.active {
            background-color: var(--bsu-blue);
            color: var(--bsu-white);
            font-weight: bold;
        }
        .pagination .page-info {
            color: var(--bsu-dark-gray);
            font-size: 0.9em;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>BIN Lookup Tool</h1>
            <p>Search Bank Identification Numbers</p>
        </div>

        <div class="content">
            <div class="search-tabs">
                <button class="tab active" id="tab_bin" onclick="switchTab('bin')">BIN Search</button>
                <button class="tab" id="tab_keyword" onclick="switchTab('keyword')">Keyword Search</button>
            </div>

            <div id="bin-form" class="search-form active">
                <div class="form-row">
                    <div class="form-group">
                        <label>BIN Number</label>
                        <input type="text" id="bin-input" placeholder="Enter BIN (e.g., 414720)">
                        <div class="hint">Searches for BINs starting with this number</div>
                    </div>
                    <div class="form-group">
                        <label>Limit</label>
                        <input type="number" id="bin-limit" value="10" min="1">
                        <div class="hint"></div>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="search-btn" onclick="runBinSearch()">Search</button>
                        <div class="hint"></div>
                    </div>
                </div>
            </div>

            <div id="keyword-form" class="search-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Keywords (space-separated)</label>
                        <input type="text" id="keyword-input" placeholder="e.g., visa credit usa">
                        <div class="hint">Searches all columns (case-insensitive)</div>
                    </div>
                    <div class="form-group">
                        <label>Limit</label>
                        <input type="number" id="keyword-limit" value="10" min="1">
                        <div class="hint"></div>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="search-btn" onclick="runKeywordSearch()">Search</button>
                        <div class="hint"></div>
                    </div>
                </div>
            </div>

            <div id="status-container"><div class="status">Loading data... please wait.</div></div>

            <div id="results" class="results hidden">
                <div class="results-header">
                    <h2 id="results-title">Results</h2>
                </div>
                <div id="table-output" class="table-container"></div>
                <div id="pagination" class="pagination hidden"></div>
            </div>
        </div>
    </div>

    <script>
        let data = [];
        let headers = [];
        let currentResults = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let currentSortColumn = null;
        let currentSortDirection = 'asc';

        // Parse CSV text into array of objects
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
            const rows = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/^"|"$/g, ''));
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                rows.push(row);
            }

            return { headers, rows };
        }

        // Load CSV data
        async function loadData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/venelinkochev/bin-list-data/refs/heads/master/bin-list-data.csv');
                const text = await response.text();

                const parsed = parseCSV(text);
                headers = parsed.headers;
                data = parsed.rows;

                document.getElementById('status-container').innerHTML =
                    `<div class="status success">System Ready. Loaded ${data.length} records.</div>`;
            } catch (error) {
                document.getElementById('status-container').innerHTML =
                    `<div class="status error">Error loading data: ${error.message}</div>`;
            }
        }

        // BIN Search
        function runBinSearch() {
            if (data.length === 0) return;

            const searchVal = document.getElementById('bin-input').value.trim();
            const limit = parseInt(document.getElementById('bin-limit').value);

            if (!searchVal) {
                document.getElementById('status-container').innerHTML =
                    '<div class="status error">Please enter a BIN number</div>';
                return;
            }

            try {
                // Search first column (BIN)
                const firstColumn = headers[0];
                const results = data.filter(row =>
                    row[firstColumn] && row[firstColumn].startsWith(searchVal)
                );

                displayResults(results, limit, `BIN Search: ${searchVal}`);
            } catch (error) {
                document.getElementById('status-container').innerHTML =
                    `<div class="status error">Error: ${error.message}</div>`;
            }
        }

        // Keyword Search
        function runKeywordSearch() {
            if (data.length === 0) return;

            const keywordsRaw = document.getElementById('keyword-input').value.trim();
            const limit = parseInt(document.getElementById('keyword-limit').value);

            if (!keywordsRaw) {
                document.getElementById('status-container').innerHTML =
                    '<div class="status error">Please enter keywords</div>';
                return;
            }

            try {
                const keywords = keywordsRaw.toLowerCase().split(/\s+/);

                // Search all columns for all keywords
                const results = data.filter(row => {
                    const rowText = Object.values(row).join(' ').toLowerCase();
                    return keywords.every(keyword => rowText.includes(keyword));
                });

                displayResults(results, limit, `Keyword Search: ${keywordsRaw}`);
            } catch (error) {
                document.getElementById('status-container').innerHTML =
                    `<div class="status error">Error: ${error.message}</div>`;
            }
        }

        // Display results as HTML table with pagination
        function displayResults(results, limit, title) {
            document.getElementById('results-title').innerHTML = title;
            currentResults = results;
            itemsPerPage = limit;
            currentPage = 1;
            currentSortColumn = null;
            currentSortDirection = 'asc';

            if (results.length === 0) {
                document.getElementById('status-container').innerHTML =
                    '<div class="status">No matching records found.</div>';
                document.getElementById('results').classList.add('hidden');
                document.getElementById('pagination').classList.add('hidden');
            } else {
                renderPage();
                renderPagination();
                document.getElementById('status-container').innerHTML =
                    `<div class="status success">Found ${results.length} matches</div>`;
                document.getElementById('results').classList.remove('hidden');
            }
        }

        // Sort results by column
        function sortResults(column) {
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }

            currentResults.sort((a, b) => {
                let valA = a[column] || '';
                let valB = b[column] || '';

                // Try to parse as numbers for numeric sorting
                const numA = parseFloat(valA);
                const numB = parseFloat(valB);

                if (!isNaN(numA) && !isNaN(numB)) {
                    return currentSortDirection === 'asc' ? numA - numB : numB - numA;
                }

                // String comparison
                valA = valA.toString().toLowerCase();
                valB = valB.toString().toLowerCase();

                if (valA < valB) return currentSortDirection === 'asc' ? -1 : 1;
                if (valA > valB) return currentSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            currentPage = 1;
            renderPage();
            renderPagination();
        }

        // Render current page of results
        function renderPage() {
            const totalPages = Math.ceil(currentResults.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageResults = currentResults.slice(startIndex, endIndex);

            // Build HTML table
            let html = '<table class="dataframe"><thead><tr>';
            headers.forEach(header => {
                const sortIndicator = currentSortColumn === header
                    ? `<span class="sort-indicator">${currentSortDirection === 'asc' ? '▲' : '▼'}</span>`
                    : '';
                html += `<th onclick="sortResults('${header}')">${header}${sortIndicator}</th>`;
            });
            html += '</tr></thead><tbody>';

            pageResults.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td>${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            document.getElementById('table-output').innerHTML = html;
        }

        // Render pagination controls
        function renderPagination() {
            const totalPages = Math.ceil(currentResults.length / itemsPerPage);

            if (totalPages <= 1) {
                document.getElementById('pagination').classList.add('hidden');
                return;
            }

            document.getElementById('pagination').classList.remove('hidden');

            let html = '';

            // Previous button
            html += `<button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>`;

            // Page numbers
            const maxPages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(totalPages, startPage + maxPages - 1);

            if (endPage - startPage < maxPages - 1) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }

            if (startPage > 1) {
                html += `<button onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    html += `<span class="page-info">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<button onclick="goToPage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span class="page-info">...</span>`;
                }
                html += `<button onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }

            // Next button
            html += `<button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;

            // Page info
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, currentResults.length);
            html += `<span class="page-info">Showing ${startItem}-${endItem} of ${currentResults.length}</span>`;

            document.getElementById('pagination').innerHTML = html;
        }

        // Navigate to specific page
        function goToPage(page) {
            const totalPages = Math.ceil(currentResults.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;

            currentPage = page;
            renderPage();
            renderPagination();

            // Scroll to top of results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Tab switching
        function switchTab(tab) {
            if (tab === 'bin') {
                document.getElementById('tab_bin').classList.add('active');
                document.getElementById('tab_keyword').classList.remove('active');
                document.getElementById('bin-form').classList.add('active');
                document.getElementById('keyword-form').classList.remove('active');
            } else {
                document.getElementById('tab_bin').classList.remove('active');
                document.getElementById('tab_keyword').classList.add('active');
                document.getElementById('bin-form').classList.remove('active');
                document.getElementById('keyword-form').classList.add('active');
            }
        }

        // Add Enter key support
        document.addEventListener('DOMContentLoaded', () => {
            loadData();

            document.getElementById('bin-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') runBinSearch();
            });

            document.getElementById('keyword-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') runKeywordSearch();
            });
        });
    </script>
</body>
</html>
